# BardPlay 1.3 (BardPlay Delphi)

BardPlay (C) 2022 TakeHide Soft.  
TakeHider@outlook.com

## 概要

【FF14対応】 MIDIデバイスからの情報を、PCキーボードのイベントに変換して送信します。  
例えば吟遊詩人を演奏状態にしておけば、PCに繋いだMIDI楽器から演奏を楽しむことができます。  
仕様上、複数の音を同時に出すことはできません。  


## 改定内容
### 1.3.0
- MIDIイベントの受信処理をバッファリングに変更。
  レスポンスが大幅に改善しました。
- 複数の音を同時に出そうとしたときに、低い音から順に弾く機能を実装。(*非推奨*)

### 1.2.0
- アイコンを変更。
- オクターブ単位でトランスポーズをさせる機能を追加。
- 安定性向上に向けたマルチスレッド処理の見直し。
- iniの設定で `SendMessage`の代わりに`PostMessage`が使えるようにした。(*非推奨*)
- `exit_outrange`を指定した際に、稀に終了しない不具合の対応




## 実行方法

あらかじめMIDIデバイスをPCに接続してから、アプリケーションを実行してください。

アプリケーションを実行すると、画面にMIDIデバイス名が表示されます。  
もしエラーが出ている場合は、MIDI機器が正しく接続されているか＆電源が入っているかを確認して、リロードボタンを押してみてください。  
複数のMIDI機器を接続していて、意図しないデバイスが表示されていたときは、リストから対象の機器を選択してください。  

MIDI機器の接続エラーが出ていると`Start`ボタンは押せません。  


### 画面操作
![画像](.\README.png)
1. MIDI Device  
  利用するMIDI機器を選択します。  
  MIDI機器は、あらかじめPCに接続をしておいてください。
2. Start  
  MIDIイベント⇒キーボード入力情報の変換処理を実行します。  
  処理が実行されると、Startボタンは、Stopボタンに切り替わります。  
  この状態で、選択されているMIDI機器で演奏をすると、対応するPCキーの情報を送信します。
3. Stop  
  MIDIイベント⇒キーボード入力情報の変換処理を停止します。  
  処理が停止されると、Stopボタンは、Startボタンに切り替わります。  
4. Quit  
  実行中の処理を止めて、アプリケーションを終了します。
5. Refresh  
  MIDI機器を再検索します。
6. Trancepose  
  1オクターブ単位でトランスポーズをしたい場合は、ここから選択します。  
  -36～+36で、12刻み(1オクターブ)で指定できます。
7. Start on Run  
  アプリケーション起動時に処理を開始させたい場合は、チェックをします。


## ライセンス

このソフトウェアは、いわゆるフリーウェアです。  
 GNU 劣等一般公衆利用許諾書(GNU LGPL)に基づいて配布されています。

* あなたはこのソフトウェアを、GNU LGPLに基づき、複製・転載・配布することができます。  
* あなたはこのソフトウェアを改変することができ、それをGNU LGPLに基づき配布することができます。  
* あなたはこのソフトウェアを利用して、あなた独自のライセンスのアプリケーションを製作・配布することができます。  
* いずれの場合も作者に許可を得る必要はありません。  
* このソフトウェアは全くの無保証です。  
  このライブラリを使用した結果生じた損害につきまして作者は一切責任を負いません。  
  あらかじめご了承ください。

詳しくはGNU LGPL[ライセンス - GNUプロジェクト - フリーソフトウェアファウンデーション](http://www.gnu.org/licenses/) もしくはその[日本語訳](https://licenses.opensource.jp/LGPL-3.0/LGPL-3.0.html) をご参照ください。

#### 本ソフトウェアはMIDIIOライブラリ(MIDIIO.dll)を使用します。

`MIDIIOライブラリ`の著作権は"`(C)2002-2012 くず / おーぷんMIDIぷろじぇくと`"様が保有しています。  
 https://openmidiproject.osdn.jp/MIDIIOLibrary.html  
LGPLライセンスで配布されています  


#### ボタンのイメージには Icons 8を使用しています。
イメージボタンの画像は [Icons 8](https://icons8.com)(https://icons8.com) を利用しています。  


## iniファイル

### [CONFIG]

* exit_outrange (default=1)  
  キーマッピングされた範囲外の音が出されたら、処理を停止します。  
  0を指定するとこのオプションは機能しません。  
  1以上の数字を指定すると、マッピングされた範囲から指定された数だけ外れた音が出されたときに、処理を停止します。  
  例えば`1`を指定すると、範囲のすぐ外側の音から有効になります。(半外の音を出した途端に、処理が止まります。)    
  鍵盤楽器など、誤って押してしまいそうなときは、少し範囲を広げてください。  

* start_on_run (default=0)  
  1を指定しすると、アプリケーション実行時に処理を開始します。  
  ただし、MIDI機器が正しく接続されていないと、実行されません。  

* device_name  
  最後に接続したMIDIデバイス名を保持します。  
  初めて使用されるときは、画面のリストから選択してください。   
  iniファイルの値を直接編集すると、うまく動かない可能性があります。  

* transepose (default=0)  
  特定のMIDI機器では、中心のC音(ド)が `C4(noteNo.60 - 261.6hz)`ではなく、1オクターブ低かったり、高かったりします。  
  `-3`～`3`の範囲でオクターブを指定することで、音程を調節することができます。

* virtual_chords (default=0)  
  1を指定すると、和音などで複数の音を同時に出そうとしたときに、低い音から順に出すようにします。  
  とは言え「同時に出す」が難しく、ほぼ気持ちの問題。  
  ノートオフの情報と混ざった時のテストが十分に出来なかったので、非推奨機能に格下げしました。  
 

### [MAPPING]

MIDIのノートをキーに対応させたもの。  
対応するMIDIノートに、割り当てたいキーを指定します。   
(MIDIノートは、READMEの最後に記載しています。)    
`SHIFT`キーや`CTRL`キーを使って、複数のキーを同時に押したいときは、押す順番にスペースで区切ってください。  
例) `SHIFT` + `S`キーのとき -> `shift s`  
逆(`s shift`)を指定してしまうと、`s`キーを押した後で`shift`キーが押されるので、意図した音が出ない可能性があります。  
特殊キーは Pythonの`pyautogui`に準拠していますが、全ての特殊キーには対応できていません。  
きっと`shift`キーと`ctrl`キーがあれば十分でしょう。  
対応するキーは[巻末](#reference)をご参照ください。


### iniファイル名について

* 実行ファイル名を変更した時は、iniファイルの名前も変えてください。  
  例）  
  　`BardPlay.exe` の時は `bardplay.ini`  
  　`BardPlay2.exe` の時は `bardplay2.ini`

* iniファイルは、Python版 BardPlay.py (`BardPlay 0.9x`)、GO言語版 BardPlay.go (`BardPlay 1.0x`)と互換性があります。  
  ただし、[CONFIG]のセクションは、本バージョンから使用されなくなったオプションがあります。  



## その他

### 対応MIDI機器について
以下の機器で動作確認をしています。  
- CACIO LK-511 61鍵 電子キーボード 光ナビゲーション  
- YAMAHA SHS-300 Sonogenic 37鍵 ショルダーキーボード

MIDIの仕様を確認して各社に対応したつもりですが、全てのメーカーの機器を試せていないので、もしかすると正しく動作しない機器があるかもしれません。  
その場合は、お手数ですがご連絡をいただければ、極力対応するようにいたします。   
(ノートOFFは `0x80` - `0xXX` と、`0x90` - `0x00` の2種類に対応しています)  

FF14等で使用していて、もし音が止まらなくなったときは、焦らずに対応するPC-Keyを押してみてください。  

### 最新ファイルおよびソースコードについて
BardPlayはGitHubにてソースコードを公開しています。  
Delphi版(1.1.x以降)に加えて、開発が終了したPython版(0.9.x)、GO言語版(1.0.x)もアップしていますので、プログラム開発に興味がある方は覗いてみてください。  
最新のリリースもGitHub上で公開していますので、他のサイトからダウンロードされている方は、GibHubをご確認ください。  
[https://github.com/TakeHider/BardPlay](https://github.com/TakeHider/BardPlay)



## 変更履歴

|バージョン|リリース日|内容|
|:--|:-:|:--|
|1.3.0|2022/9/24|レスポンスの改善|
|1.2.0|2022/9/19|1オクターブ単位でトランスポーズ機能を追加<br/> パフォーマンスの向上、および軽微な不具合対応|
|1.1.0|2022/9/15|Delphi版作成|

---

## 参考資料

.iniファイル [MAPPING]セクション設定ガイド 

### キーマッピング 

|指定文字列|キーコード<br />(参考)|
|:-:|:-:|
|backspace | 0x08|
|tab       | 0x09|
|enter     | 0x0D|
|shift     | 0x10|
|ctrl      | 0x11|
|alt       | 0x12|
|pause     | 0x13|
|capslock  | 0x14|
|esc       | 0x1B|
|space     | 0x20|
|pageup    | 0x21|
|pagedown  | 0x22|
|end       | 0x23|
|home      | 0x24|
|left      | 0x25|
|up        | 0x26|
|right     | 0x27|
|down      | 0x28|
|printscrn | 0x2C|
|insert    | 0x2D|
|delete    | 0x2E|
|0         | 0x30|
|1         | 0x31|
|2         | 0x32|
|3         | 0x33|
|4         | 0x34|
|5         | 0x35|
|6         | 0x36|
|7         | 0x37|
|8         | 0x38|
|9         | 0x39|
|a         | 0x41|
|b         | 0x42|
|c         | 0x43|
|d         | 0x44|
|e         | 0x45|
|f         | 0x46|
|g         | 0x47|
|h         | 0x48|
|i         | 0x49|
|j         | 0x4A|
|k         | 0x4B|
|l         | 0x4C|
|m         | 0x4D|
|n         | 0x4E|
|o         | 0x4F|
|p         | 0x50|
|q         | 0x51|
|r         | 0x52|
|s         | 0x53|
|t         | 0x54|
|u         | 0x55|
|v         | 0x56|
|w         | 0x57|
|x         | 0x58|
|y         | 0x59|
|z         | 0x5A|
|f1        | 0x70|
|f2        | 0x71|
|f3        | 0x72|
|f4        | 0x73|
|f5        | 0x74|
|f6        | 0x75|
|f7        | 0x76|
|f8        | 0x77|
|f9        | 0x78|
|f10       | 0x79|
|f11       | 0x7A|
|f12       | 0x7B|


### MIDIノート情報(FF14準拠)

| Tone    | Note Number | .ini File  |
|:-------:| -----------:|:----------:|
| C-1     | 0           | ×    |
| C#      | 1           | ×    |
| D       | 2           | ×    |
| D#      | 3           | ×    |
| E       | 4           | ×    |
| F       | 5           | ×    |
| F#      | 6           | ×    |
| G       | 7           | ×    |
| G#      | 8           | ×    |
| A       | 9           | ×    |
| A#      | 10          | ×    |
| B       | 11          | ×    |
| C0      | 12          | ×    |
| C#      | 13          | ×    |
| D       | 14          | ×    |
| D#      | 15          | ×    |
| E       | 16          | ×    |
| F       | 17          | ×    |
| F#      | 18          | ×    |
| G       | 19          | ×    |
| G#      | 20          | ×    |
| A       | 21          | ×    |
| A#      | 22          | ×    |
| B       | 23          | ×    |
| C1      | 24          | ×    |
| C#      | 25          | ×    |
| D       | 26          | ×    |
| D#      | 27          | ×    |
| E       | 28          | ×    |
| F       | 29          | ×    |
| F#      | 30          | ×    |
| G       | 31          | ×    |
| G#      | 32          | ×    |
| A       | 33          | ×    |
| A#      | 34          | ×    |
| B       | 35          | ×    |
| C2      | 36          | ×    |
| C#      | 37          | ×    |
| D       | 38          | ×    |
| D#      | 39          | ×    |
| E       | 40          | ×    |
| F       | 41          | ×    |
| F#      | 42          | ×    |
| G       | 43          | ×    |
| G#      | 44          | ×    |
| A       | 45          | ×    |
| A#      | 46          | ×    |
| B       | 47          | ×    |
| **C3**  | **48**      | ○    |
| C#      | 49          | ○    |
| D       | 50          | ○    |
| D#      | 51          | ○    |
| E       | 52          | ○    |
| F       | 53          | ○    |
| F#      | 54          | ○    |
| G       | 55          | ○    |
| G#      | 56          | ○    |
| A       | 57          | ○    |
| A#      | 58          | ○    |
| B       | 59          | ○    |
| **C4**  | **60**      | ○    |
| C#      | 61          | ○    |
| D       | 62          | ○    |
| D#      | 63          | ○    |
| E       | 64          | ○    |
| F       | 65          | ○    |
| F#      | 66          | ○    |
| G       | 67          | ○    |
| G#      | 68          | ○    |
| A       | 69          | ○    |
| A#      | 70          | ○    |
| B       | 71          | ○    |
| **C5**  | **72**      | ○    |
| C#      | 73          | ○    |
| D       | 74          | ○    |
| D#      | 75          | ○    |
| E       | 76          | ○    |
| F       | 77          | ○    |
| F#      | 78          | ○    |
| G       | 79          | ○    |
| G#      | 80          | ○    |
| A       | 81          | ○    |
| A#      | 82          | ○    |
| B       | 83          | ○    |
| **C6**  | **84**      | ○    |
| C#      | 85          | ×    |
| D       | 86          | ×    |
| D#      | 87          | ×    |
| E       | 88          | ×    |
| F       | 89          | ×    |
| F#      | 90          | ×    |
| G       | 91          | ×    |
| G#      | 92          | ×    |
| A       | 93          | ×    |
| A#      | 94          | ×    |
| B       | 95          | ×    |
| C7      | 96          | ×    |
| C#      | 97          | ×    |
| D       | 98          | ×    |
| D#      | 99          | ×    |
| E       | 100         | ×    |
| F       | 101         | ×    |
| F#      | 102         | ×    |
| G       | 103         | ×    |
| G#      | 104         | ×    |
| A       | 105         | ×    |
| A#      | 106         | ×    |
| B       | 107         | ×    |
| C8      | 108         | ×    |
| C#      | 109         | ×    |
| D       | 110         | ×    |
| D#      | 111         | ×    |
| E       | 112         | ×    |
| F       | 113         | ×    |
| F#      | 114         | ×    |
| G       | 115         | ×    |
| G#      | 116         | ×    |
| A       | 117         | ×    |
| A#      | 118         | ×    |
| B       | 119         | ×    |
| C9      | 120         | ×    |
| C#      | 121         | ×    |
| D       | 122         | ×    |
| D#      | 123         | ×    |
| E       | 124         | ×    |
| F       | 125         | ×    |
| F#      | 126         | ×    |
| G       | 127         | ×    |
